extends ../../layouts/default
include ../../mixins/filterStatus
include ../../mixins/search
include ../../mixins/pagination
include ../../mixins/form-change-multi
include ../../mixins/alert
include ../../mixins/sort
include ../../mixins/noAccess


block main
  if role && role.permissions && role.permissions.includes('products-category-view')
    .container-fluid
      .d-flex.justify-content-between.align-items-center.mb-4
        h2.mb-0.text-primary Trang danh sách danh mục sản phẩm
        if role && role.permissions && role.permissions.includes('products-category-create')
          a.btn.btn-primary(href=`${prefixAdmin}/products-category/create`)
            i.fas.fa-plus.mr-2
            | Thêm mới
      +alert-success("5000")
      .card.shadow-sm.border-0.mb-4
        .card-body
          .row.mb-3.align-items-center
            .col-md-4
              +filter-status(filterStatus)
            .col-md-4
              +search(query.keyword, query.status)
            .col-md-4
              +sort_danhmuc()
          +form-change-multi(`${prefixAdmin}/products-category/change-multi`)
            table.table.table-hover.table-bordered.table-striped.align-middle.mb-0
              thead.thead-dark
                tr.text-center
                  th(style="width: 50px")
                    input(type="checkbox", name="checkall")
                  th(style="width: 60px") Hình
                  th(style="min-width: 150px") Tên danh mục
                  th(style="min-width: 200px") Mô tả
                  th Vị trí
                  th Người tạo
                  th Người sửa
                  th Trạng thái
                  th(style="width: 200px") Thao tác
              tbody
                each item, index in record
                  tr
                    td.text-center
                      input(type="checkbox", name="id", value=item._id)
                    td.text-center
                      if item.thumbnail
                        img(
                          src=`/${item.thumbnail}`,
                          alt="Thumbnail",
                          class="img-thumbnail rounded border border-2",
                          style="width: 50px; height: 50px; object-fit: cover;"
                        )
                      else
                        span.text-muted
                          i.fas.fa-folder.fa-2x
                    td= '— '.repeat(item.indent) + ' ' + item.title
                    td
                      if item.description
                        != item.description
                      else
                        span.text-muted No description
                    td
                      input(
                        type="number",
                        value=item.position,
                        style="width:60px",
                        min="1",
                        name="position",
                        class="form-control form-control-sm"
                      )
                    td
                      | #{item.accountFullName}
                      br
                      if item.createdBy && item.createdBy.account_id && item.createdBy.createAt
                        small.text-muted #{dayjs(item.createdBy.createAt).format('DD/MM/YYYY HH:mm')}
                    td
                      | #{item.accountFullName}
                      br
                      if item.updatedBy && item.updatedBy.account_id && item.updatedBy.updateAt
                        small.text-muted #{dayjs(item.updatedBy.updateAt).format('DD/MM/YYYY HH:mm')}
                    td.text-center
                      if role && role.permissions && role.permissions.includes('products-category-edit')
                        if item.status == "active"
                          a(
                            href="javascript:;",
                            data-status="active",
                            data-id=item._id,
                            button-change-status="",
                            class="badge badge-success px-3 py-2"
                          )
                            i.fas.fa-check-circle.mr-1
                            | Hiển thị
                        else
                          a(
                            href="javascript:;",
                            data-status="inactive",
                            data-id=item._id,
                            button-change-status="",
                            class="badge badge-danger px-3 py-2"
                          )
                            i.fas.fa-ban.mr-1
                            | Ẩn
                    td.text-center
                      if role && role.permissions && role.permissions.includes('products-category-edit')
                        a(
                          href=`${prefixAdmin}/products-category/edit/${item._id}`,
                          class="btn btn-warning btn-sm mx-1"
                        )
                          i.fas.fa-edit.mr-1
                      if role && role.permissions && role.permissions.includes('products-category-view')
                        a(
                          href=`${prefixAdmin}/products-category/detail/${item._id}`,
                          class="btn btn-primary btn-sm mx-1"
                        )
                          i.fas.fa-info-circle.mr-1
                      if role && role.permissions && role.permissions.includes('products-category-delete')
                        button(
                          class="btn btn-danger btn-sm mx-1",
                          button-delete,
                          data-id=item._id
                        )
                          i.fas.fa-trash.mr-1
      +pagination(pagination)
      form(
        action="",
        method="POST",
        id="form-change-status",
        data-path=`${prefixAdmin}/products-category/change-status`
      )
        input(type="hidden", name="_method", value="PATCH")
        input(type="hidden", name="redirect", id="redirect-input")
      form(
        action="",
        method="POST",
        id="form-delete-item",
        data-path=`${prefixAdmin}/products-category/delete`
      )
        input(type="hidden", name="_method", value="DELETE")
      script(src="/admin/js/product-category.js")
  else
    +noAccess()