extends ../../layouts/default
include ../../mixins/alert
include ../../mixins/noAccess

block main
  if role && role.permissions && role.permissions.includes('account-edit')
    .container-fluid
      .col-lg-8.mx-auto
        .card.shadow-sm.border-0
          .card-header.bg-warning.text-white
            h4.mb-0 Chỉnh sửa tài khoản
          .card-body
            +alert-error(3000)
            +alert-success(3000)
            form(method="POST", action=`${prefixAdmin}/accounts/edit/${record._id}?_method=POST`, enctype="multipart/form-data")
              .form-group.mb-3
                label(for="fullName") Họ và tên
                input.form-control(type="text", name="fullName", id="fullName", value=record.fullName, required)
              .form-group.mb-3
                label(for="email") Email
                input.form-control(type="email", name="email", id="email", value=record.email, required)
              .form-group.mb-3
                label(for="password") Mật khẩu mới
                input.form-control(type="password", name="password", id="password", placeholder="********")
              .form-group.mb-3
                label(for="phone") Số điện thoại
                input.form-control(type="text", name="phone", id="phone", value=record.phone, required)
              .form-group.mb-3
                label(for="role_id") Quyền
                select.form-control(name="role_id", id="role_id", required)
                  option(value="") -- Chọn quyền --
                  each role in roles
                    option(value=role._id, selected=record.role_id == role._id) #{role.title}
              .form-group.mb-3
                label(for="avatar") Ảnh đại diện
                input.form-control-file(type="file", name="avatar", id="thumbnail", accept="image/*")
                br
                if record.avatar
                  img#preview-img(src=`/${record.avatar}`, alt="Preview", style="max-width: 200px; margin-top: 10px;")
                  br
                  button#remove-btn(type="button", class="btn btn-sm btn-danger mt-2") Xóa ảnh
                  input(type="hidden", name="currentThumbnail", value=record.avatar)
                else
                  img#preview-img(src="", alt="Preview", style="max-width: 200px; margin-top: 10px; display: none;")
                  br
                  button#remove-btn(type="button", style="display: none;" class="btn btn-sm btn-danger") Xóa ảnh
              .form-group.mb-3
                label(for="status") Trạng thái
                select.form-control(name="status", id="status")
                  option(value="active", selected=record.status == 'active') Hoạt động
                  option(value="inactive", selected=record.status == 'inactive') Dừng hoạt động
              .d-flex.justify-content-end.mt-4
                button.btn.btn-warning(type="submit")
                  i.fas.fa-save.mr-1
                  | Cập nhật
                a.btn.btn-secondary.ml-2(href=`${prefixAdmin}/accounts`)
                  i.fas.fa-arrow-left.mr-1
                  | Quay lại
  else
    +noAccess()
